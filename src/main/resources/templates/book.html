<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymleaf.org">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title th:text="${book.name}">Course</title>
    <link rel="stylesheet" href="../static/css/bootstrap.min.css" >
    <link rel="stylesheet" href="../static/css/diy.css" >
</head>
<body class="diy_background">
<header class="p-3 bg-white text-dark ">
    <div class="container">
        <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">

            <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
                <li><a href="/" class="nav-link px-2 text-secondary">Home</a></li>
                <li><a href="#" class="nav-link px-2 text-dark">About</a></li>
            </ul>

            <form class="col-12 col-lg-auto mb-3 mb-lg-0 me-lg-3" method="post" th:action="@{/search}">
                <input type="search" class="form-control form-control-dark" name="searchContent" placeholder="Search..." aria-label="Search">
            </form>

            <div class="text-end">
                <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
                    <li><a href="/" th:href="@{/sign}" class="nav-link px-2 text-dark" th:if="${user}==null">Sign up</a></li>
                    <li><a href="#"  th:href="@{/login}" class="nav-link px-2 text-dark" th:if="${user}==null">Login</a></li>
                    <li><a href="#"  class="nav-link px-2 text-dark" th:if="${user}!=null" th:text="${user.username}">Login</a></li>
                    <li><a href="#" th:href="@{/logout}" class="nav-link px-2 text-dark" th:if="${user}!=null">Log out</a></li>
                </ul>
            </div>
        </div>
    </div>
</header>



<main class="container ">
    <div class="p-4 p-md-5 mb-4 text-white rounded bg-black " style="opacity: 0.6;">
        <div class="col-md-6 px-0">
            <h1 class="display-4 fst-italic"> [[${book.name}]]</h1>
            <p class="lead my-3">This website provides open access e-learning resources so that every one who wants to learn can get learning
                material from this website.</p>
            <p class="lead mb-0"><a href="#" class="text-white fw-bold" style="text-decoration: none">Start your learning journey</a></p>
        </div>

    </div>
    <div class="card" >
        <div class="row no-gutters">
            <div class="col-md-2">
                <div class="diy_margin"><img src="../static/image/background/math.jpg" width=200px height=250px class="diy_padding"></div>

            </div>
            <div class="col-md-2">
                <h2 th:text="${book.name}" style="padding-top: 2em">Java</h2>
                <p style="margin-top: 1em">Author:[[${book.author}]]</p>
                <div id="likeArea">
                    <div th:fragment="likePo">
                        Likes: <a th:text="${book.likes}"></a>

                    </div>
                </div>
                <div id="ScoreArea" style="margin-top: 1em">
                    <div th:fragment="Score">
                        Score: <a th:text="${score}"></a>

                    </div>
                </div>
            </div>
            <div class="col-md-5">
                <div class="card-body" >

                    <p class="card-text"  th:text="${book.description}" style="padding-top: 3em">
                        Description
                    </p>



                </div>
            </div>
            <div class="col-md-3">



                    <div th:if="${user}!=null" style="margin-top: 2em">
                        <div style="margin-top: 3em">
                            like this book:<a onclick="like(this)" id="likeb1" th:attr="data-bookid=${book.bookid}"  style="padding-left: 1em">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-heart" viewBox="0 0 16 16">
                                <path d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01L8 2.748zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15z"></path>
                            </svg>
                        </a>
                        </div>
                        <div style="margin-top: 3em">
                            Make your sore:
                            <a onclick="score(1)" id="score1" th:attr="data-bookid=${book.bookid}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
                                    <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                                </svg>
                            </a>
                            <a onclick="score(2)" id="score2" th:attr="data-bookid=${book.bookid}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
                                    <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                                </svg>
                            </a>
                            <a onclick="score(3)" id="score3" th:attr="data-bookid=${book.bookid}" >
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
                                    <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                                </svg>
                            </a>
                            <a onclick="score(4)" id="score4" th:attr="data-bookid=${book.bookid}"  >
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
                                    <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                                </svg>
                            </a>
                            <a onclick="score(5)" id="score5" th:attr="data-bookid=${book.bookid}"  >
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
                                    <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                                </svg>
                            </a></div>
                    </div>
                    <div style="margin-top: 3em"><a th:href="@{${book.position}}" href="#" class="text-black ">Read the Book</a>
                        <a th:href="@{${book.position}}" href="#" class="text-black  ">Download the Book</a>
                    </div>


            </div>
        </div>
    </div>
    <div class="container " style="margin-top: 2em">
        <div  >
            <h3 style="padding-bottom: 1em" class="text-center">
                Comments of [[${book.name}]]
            </h3></div>
        <div id="commentArea" class="bg-white diy_visible" style="border-radius: 0px">
            <div th:fragment="commentList" >
                <div th:each="comment:${comments}" style="border-bottom: 1px silver solid" >
                    <div style="padding: 1em" class="row">
                        <div>
                            <img src="..\static\image\background\leaf.jpg" style="border-radius: 100px" height="40px" width="40px">
                            <a th:text="${comment.nickname}" style="padding-left: 1em"></a>
                            <span th:text="${#dates.format(comment.createTime,'yyyy-MM-dd HH:mm')}" style="float: right"></span>
                            <a  th:attr="data-commentid=${comment.id},data-commentnickname=${comment.nickname}" th:if="${user}!=null" onclick="reply(this)" style="text-decoration-color:white">reply</a>
                        </div>



                    </div>
                    <div th:text="${comment.content}" style="padding-top: 1em;padding-bottom: 2em;padding-left: 2em"></div>
                </div>
            </div>
        </div>
    </div>

</main>


    <div id="commentForm" th:if="${user}!=null" class="position-sticky container bg-white " style="bottom: 0rem; ">
        <div >
            <input hidden name="bookBookid" th:value="${book.bookid}">
            <input hidden name="theCommentId" th:value="-1">
            <input hidden name="nickname" th:value="${user.username}">
            <div class="row border-5 border-danger">
                <textarea name="content" placeholder="make your comment " class="border-0"></textarea>
                <button id="post-btn" class="btn btn-outline-secondary">comment</button>
            </div>

        </div>
    </div>





















<script src="../static/js/jquery.js"></script>
<script src="../static/js/bootstrap.bundle.min.js" ></script>
<script th:inline="javascript">
    $('#post-btn').click(function(){
        postData();
    });
    $(function(){
        $("#commentArea").load(/*[[@{/comments/{bookid}(bookid=${book.bookid})}]]*/"");
    });
    function postData(){
        $("#commentArea").load(/*[[@{/comments}]]*/"",{
            "theCommentId":$("[name='theCommentId']").val(),
            "bookBookid":$("[name='bookBookid']").val(),
            "content":$("[name='content']").val(),
            "nickname":$("[name='nickname']").val()
        },function(responseTxt,statusTxt,xhr){
            clearContent();
        });
    }
    function clearContent(){
      $("[name='content']").val('');
        $("[name='theCommentId']").val(-1);
    }
    function reply(obj){
        var commentId = $(obj).data('commentid');
        var commentNickName=$(obj).data('commentnickname');
        $("[name='content']").attr("placeholder","@"+commentNickName).focus();
        $("[name='theCommentId']").val(commentId);
    }
    function like(obj){
        var bookid = $(obj).data('bookid');
        test();
        $("#likeArea").load(/*[[@{/book/likebook}]]*/"",{"bookBookid":bookid});
    }
    function test(){
        document.getElementById("likeb1").style.color="#ff0000";
    }
    function score(i){
        var points = i;
        var bookid = $("[name='bookBookid']").val();
        if(i==1){
            document.getElementById("score1").style.color="#ffff00";
        }
        if(i==2){
            document.getElementById("score1").style.color="#ffff00";
            document.getElementById("score2").style.color="#ffff00";
        }
        if(i==3){
            document.getElementById("score1").style.color="#ffff00";
            document.getElementById("score2").style.color="#ffff00";document.getElementById("score3").style.color="#ffff00";

        }
        if(i==4){
            document.getElementById("score1").style.color="#ffff00";document.getElementById("score2").style.color="#ffff00";
            document.getElementById("score3").style.color="#ffff00";document.getElementById("score4").style.color="#ffff00";
        }
        if(i==5){
            document.getElementById("score1").style.color="#ffff00";document.getElementById("score2").style.color="#ffff00";
            document.getElementById("score3").style.color="#ffff00";document.getElementById("score4").style.color="#ffff00";
            document.getElementById("score5").style.color="#ffff00";
        }
        $("#ScoreArea").load(/*[[@{/book/bookScore}]]*/"",{"bookBookid":bookid,"score":points});
    }

</script>
</body>
</html>